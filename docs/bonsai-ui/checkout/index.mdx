---
title: Bonsai Checkout
description: Learn about the Bonsai Checkout and how to use it.
sidebar_position: 1
---

This document explains how to use the Bonsai Checkout, and guides you through the process of
integrating it with your website.

# Integrations

There are 2 ways to integrate with Bonsai Checkout:

1. `Embedded` - embedding the Bonsai Checkout in your website
2. `Hosted` - redirecting to a secure Bonsai Checkout URL

Based on your preferred experience, choose the one that fits your needs.

## Embedded

This integration enables you to run the checkout process on your domain.

You can obtain the `order` information after a successful checkout through _callbacks_, explained in the following sections.

### Query parameters

`Checkout` app reads the following query parameters from the URL:

| Name     | Value         | Description                                    | Required |
| :------- | :------------ | :--------------------------------------------- | :------- |
| `bonsai` | `checkout_ID` | Starts checkout process using provided cart ID | Yes      |

:::info Example
https://your.domain.com/checkout?bonsai=checkout_abcdef
:::

`bonsai` parameter is the only required parameter, and it should be provided with a `cart id` that you want to check out.

### Callbacks

Callbacks are optional, and you can use them to obtain `order` information after a successful checkout.
These functions must be provided to the `init` function (further details in _[step 3 section](#step-3-configure-bonsai-checkout)_).

:::

### Step 1: Create a page

You will need to create a page on your website that will host the Bonsai Checkout,
e.g. `https://your.domain.com/checkout`. We will refer to this page as the `Checkout page`.

### Step 2: Add Bonsai Checkout dependencies

Add the Bonsai Checkout dependencies to `Checkout page`:

```html title="checkout.html"
<head>
  <!-- Bonsai Checkout CSS -->
  <link rel="stylesheet" href="https://ui.getbonsai.com/index.css" />
</head>

<body>
  <!-- Bonsai Checkout JS -->
  <script type="text/javascript" src="https://ui.getbonsai.com/index.js"></script>
</body>
```

### Step 3: Configure Bonsai Checkout

```html title="checkout.html"
<!-- as defined in the previous step -->
<!-- <script type="text/javascript" src="https://ui.getbonsai.com/index.js"></script> -->
<script type="text/javascript">
  // Extract bonsai object from window
  var bonsai = window.__BONSAI__;

  function customOrderSuccessMessage({ email }) {
    return `Thank you! You will receive a confirmation email with your order details shortly. Your account has been created using ${email}.`;
  }

  // Initialize bonsai with configuration options
  bonsai.init({
    accountId: '<API_KEY_VALUE>',
    onBonsaiEvent: ({ tag, event }) => {
      switch (tag) {
        case 'order_completed':
          console.log('Order completed', event);
          break;
      }
    },
    customOrderSuccessMessage,
  });
</script>
```

#### Checkout types

Bonsai Checkout supports 2 checkout types: Single product and Multi product.
You can set it using the `checkoutType` (further details in _[step 3 section](#step-3-configure-bonsai-checkout)_).

##### Single product

Bonsai UI can run in single product mode, which means that it will display a single product with no cart support.
`productId` and `variantId` are required for this mode, and the application will automatically create a cart for you,
containing the provided product. This `cartId` will be re-used for future checkouts, until the cart is deleted after
successful checkout.

##### Multi product

Multi product mode is the default mode, and it supports multiple products and variants.
It requires a cart ID, which you need to create using the `Bonsai Carts API`.

#### Configuration options

```typescript
type Config = {
  /* REQUIRED: */

  /* Authenticates your account with Bonsai services */
  accountId: string;

  /* The type of checkout.
   *
   * - `single-product` - checkout for a single product with no cart support
   *    - `productId` - product ID
   *    - `variantId` - variant ID
   *
   * -  `multi-product` - checkout for multiple products, using regular cart
   *    - `cartId` - cart ID
   */
  checkoutType: 'single-product' | 'multi-product';

  /* single-product checkout options */
  productId: string;
  variantId: string;

  /* multi-product checkout options */
  cartId: string;

  /* OPTIONAL */

  /* Deprecated: Instead, please use onBonsaiEvent with "order_completed" tag. */
  onSuccess?: (order: Order) => void;
  /* Deprecated: Instead, please use onBonsaiEvent with "shipping_info_entered" tag. */
  onShippingSubmit?: (context: ShippingContext) => void;

  /* A callback that will be invoked when user submits payment information */
  bonsaiEvents?: {
    /* A version of the Bonsai events. This allows us to make breaking changes
     * to the events without breaking your integration. */
    version: 'v1';
    /* A callback that will be invoked when a Bonsai event has been emitted. */
    onBonsaiEvent: (event: BonsaiEvent) => void; // More details in "Bonsai Events" section below
  };

  /* A color for the button fill */
  buttonBackground?: string;
  /* A color for the button font color */
  buttonTextColor?: string;
  /* A custom google font override */
  font?: string;
  /* A custom message displayed on the cart page */
  customInfoMessage?: string;
  /* A custom message displayed on the order success page. `ShippingContext` data is provided as an argument
   * to the function, so you can get access to the ShippingContext information. If `null` is returned, the
   * default message will be displayed.
   */
  customOrderSuccessMessage?: (context: ShippingContext) => string | null;
  /* A custom link displayed on the order success page. If not provided, the link will not be displayed.
   * Requires an `href` value. If `text` not provided, the link will use a default text instead ("Go back").
   */
  customOrderSuccessLink?: { href: string; text?: string };
  /* If provided, the checkout header image will link to the provided URL */
  originUrl?: string;
  /* ID of the order provided to Bonsai by the party who placed the order - should be unique per order if passed. */
  externalOrderId?: string;
};

type ShippingContext = {
  cartId: string;
  shipping: {
    address: {
      address1: string;
      address2?: string;
      city: string;
      country: string;
      firstName: string;
      lastName: string;
      zip: string;
    };
    email: string;
    phone: string;
  };
};
```

#### Bonsai Events

##### Configuration

Bonsai UI emits events during various stages of the checkout process. You can listen to these events by providing a `bonsaiEvents` object to the configuration.

```typescript
bonsaiEvents: {
  version: 'v1';
  onBonsaiEvent: (event: BonsaiEvent) => void;
};
```

A `bonsaiEvents` object expects a `version` and an `onBonsaiEvent` callback.

A `version` field is used to ensure that the events emitted by Bonsai UI are compatible with your integration.

_Please note that additional fields are not considered breaking changes, and will not result in a version bump. Likewise, additional events are also not considered a breaking change. Only changes to existing fields will result in a version bump._

##### Usage

Provided `onBonsaiEvent` callback will be invoked when a Bonsai event has been emitted.
Each event is tagged with a `tag` property, which you can use to distinguish between different events.

```typescript
type BonsaiEvent =
  | {
      tag: 'shipping_info_entered';
      event: {
        cartId: string;
        currency: string;
        cartSubtotal: number;
        items: Item[];
        shipping: Shipping;
      };
    }
  | {
      tag: 'payment_info_entered';
      event: {
        cartId: string;
        currency: string;
        cartSubtotal: number;
        items: Item[];
      };
    }
  | {
      tag: 'order_completed';
      event: {
        cartId: string;
        currency: string;
        orderId: string;
        orderSubtotal: number;
        orderShipping: number;
        orderSubtotalTax: number;
        orderDuties: number;
        orderTotalCustomerCharge: number;
        items: Item[];
      };
    };

type Item = {
  productId: string;
  variantId: string;
  quantity: number;
  productName: string;
  brandName: string;
  merchantName: string;
  price: number;
  compareAtPrice?: number;
};

type Shipping = {
  address: Address;
  email: string;
  phone: string;
};

type Address = {
  address1: string;
  address2?: string;
  city: string;
  country: string;
  firstName: string;
  lastName: string;
  zip: string;
};
```

The events are sent in the following order:

| Event tag               | Description                                                                                              |
| :---------------------- | :------------------------------------------------------------------------------------------------------- |
| `shipping_info_entered` | Shipping information has been successfuly entered, and the user has clicked "Continue to payment" button |
| `payment_info_entered`  | Payment information has been successfuly entered, and the user has clicked "Submit order" button         |
| `order_completed`       | Order has been completed, and the user was redirected to Order Success page                              |

##### Example

```typescript
bonsai.init({
  ...config, // the rest of the configuration
  bonsaiEvents: {
    version: 'v1',
    onBonsaiEvent: ({ tag, event }) => {
      switch (tag) {
        case 'shipping_info_entered':
          console.log('Shipping info entered', event);
          break;
        case 'payment_info_entered':
          console.log('Payment info entered', event);
          break;
        case 'order_completed':
          console.log('Order completed', event);
          break;
      }
    },
  },
});
```

#### Script data attributes

| Data attribute | Value                                                                                | Description                    | Required |
| :------------- | :----------------------------------------------------------------------------------- | :----------------------------- | :------- |
| `src`          | `https://ui.getbonsai.com/index.js` _or_ `https://staging-ui.getbonsai.com/index.js` | Bonsai Checkout Javascript URL | ✅       |

### Step 4: Create cart

In order to start the checkout process, you need to create a cart first.
You can do this by using `Bonsai Carts API`

```bash
curl -L -X POST 'https://api.shopbonsai.ca/carts/v1/submit' \
-H 'Content-Type: application/json' \
-H 'Accept: application/json' \
-H 'API-Key: <API_KEY_VALUE>' \
--data-raw '{
  "products": [
    {
      "id": "clad6pg5z00eu012gfz7hfm92",
      "variantId": "M00679529706740",
      "quantity": 1
    }
  ]
}'

# result:
# {"data":{"id":"RANDOM_CART_ID"}}
```

:::info
You can find more information about how to create and update carts using the `Bonsai Carts API` [here](/docs/api/carts/carts-api).
:::

### Step 5: Redirect to checkout

After you have created a cart, and obtained a `cart id`, you can redirect the user to the `Checkout page`.

You will need to add a `bonsai` query parameter to the `Checkout page` URL, with the `cart id` as its value.

:::info Example
https://your.domain.com/checkout?bonsai=checkout_ID
:::

## Hosted

Coming soon...

## Changelog

- October 24, 2023
  - `onShippingSubmit` and `onSuccess` callbacks are deprecated.
  - `bonsaiEvents` supports the same functionality, and should be used instead.